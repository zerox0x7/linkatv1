# دليل تخصيص قسم البطل (Hero Section Customizer)

## نظرة عامة

تم تطوير نظام حديث ومرن لتخصيص قسم البطل (Hero Section) في الثيمات، يدعم إضافة حتى **6 صور** مع كامل بياناتها (عنوان، عنوان فرعي، زر، ورابط).

---

## المميزات الرئيسية

### ✅ 1. إضافة صور متعددة (حتى 6 صور)
- يمكنك إضافة من 1 إلى 6 صور للبطل
- كل صورة لها بياناتها المستقلة:
  - **العنوان الرئيسي** (إجباري)
  - **العنوان الفرعي** (اختياري)
  - **نص الزر** (اختياري)
  - **رابط الزر** (اختياري)
  - **الصورة** (إجبارية - PNG, JPG, WEBP - الحد الأقصى 2MB)

### ✅ 2. تعديل الصور الموجودة
- يمكنك تعديل أي صورة من الصور المضافة
- تحديث النصوص بدون تغيير الصورة
- أو تغيير الصورة مع النصوص

### ✅ 3. إعادة ترتيب الصور
يوجد **3 طرق** لإعادة ترتيب الصور:

#### أ. السحب والإفلات (Drag & Drop) 🎯 موصى به
- استخدم أيقونة السحب (⋮⋮) أعلى كل صورة
- اسحب الصورة وأفلتها في المكان المطلوب
- يتم حفظ الترتيب تلقائياً

#### ب. أزرار الترتيب
- زر "↑" لتحريك الصورة لأعلى
- زر "↓" لتحريك الصورة لأسفل

#### ج. يدوي
- احذف الصور وأعد إضافتها بالترتيب المطلوب

### ✅ 4. معاينة فورية (Live Preview)
- معاينة فورية للصورة عند رفعها
- عرض جميع البيانات لكل صورة
- رقم تسلسلي (#1, #2, إلخ) لكل صورة

### ✅ 5. حذف الصور
- يمكنك حذف أي صورة بضغطة زر
- يظهر تأكيد قبل الحذف لتجنب الحذف الخاطئ

---

## كيفية الاستخدام

### خطوات إضافة صورة جديدة:

1. **انتقل إلى صفحة تخصيص الثيم**
   ```
   لوحة التحكم > الثيمات > تخصيص الثيم النشط
   ```

2. **اختر تبويب "قسم البطل (Hero)"**

3. **املأ النموذج:**
   - ارفع الصورة (إجباري)
   - أدخل العنوان الرئيسي (إجباري)
   - أدخل العنوان الفرعي (اختياري)
   - أدخل نص الزر (مثال: "تسوق الآن")
   - أدخل رابط الزر (مثال: "/products")

4. **اضغط على "إضافة الصورة"**
   - سيتم رفع الصورة وحفظها تلقائياً
   - ستظهر الصورة في قائمة "الصور الحالية"

### خطوات تعديل صورة موجودة:

1. **اضغط على زر "تعديل"** للصورة المطلوبة
2. **سيتم تحميل بيانات الصورة في النموذج**
3. **عدّل البيانات المطلوبة:**
   - يمكنك تغيير النصوص فقط
   - أو رفع صورة جديدة أيضاً
4. **اضغط على "تحديث الصورة"**
5. **أو اضغط "إلغاء"** للرجوع بدون حفظ

### خطوات إعادة ترتيب الصور:

#### الطريقة الأولى: السحب والإفلات (الأسهل)
1. **ابحث عن أيقونة السحب** (⋮⋮) أعلى كل صورة
2. **اضغط واسحب** الأيقونة
3. **أفلت الصورة** في المكان المطلوب
4. **يتم الحفظ تلقائياً** ✅

#### الطريقة الثانية: أزرار الترتيب
1. **استخدم زر "↑"** لتحريك الصورة لأعلى
2. **استخدم زر "↓"** لتحريك الصورة لأسفل

---

## البنية التقنية

### جدول قاعدة البيانات
الجدول: `themes_data`

العمود المستخدم: `hero_data` (JSON)

### بنية البيانات المحفوظة:
```json
{
  "slides": [
    {
      "id": "unique_id_1",
      "title": "عنوان الصورة الأولى",
      "subtitle": "عنوان فرعي",
      "button_text": "تسوق الآن",
      "button_link": "/products",
      "image": "themes/theme_name/hero/image1.jpg",
      "order": 0
    },
    {
      "id": "unique_id_2",
      "title": "عنوان الصورة الثانية",
      "subtitle": "عنوان فرعي آخر",
      "button_text": "اكتشف المزيد",
      "button_link": "/about",
      "image": "themes/theme_name/hero/image2.jpg",
      "order": 1
    }
    // ... حتى 6 صور
  ]
}
```

---

## الملفات المعدّلة

### 1. Controller (Backend Logic)
**الملف:** `app/Livewire/ThemeCustomizer.php`

**الدوال الجديدة:**
- `addHeroSlide()` - إضافة صورة جديدة
- `editHeroSlide($index)` - تحميل صورة للتعديل
- `updateHeroSlide()` - حفظ التعديلات
- `deleteHeroSlide($index)` - حذف صورة
- `moveSlideUp($index)` - تحريك لأعلى
- `moveSlideDown($index)` - تحريك لأسفل
- `reorderSlides($orderedIds)` - إعادة ترتيب بالسحب والإفلات
- `saveHeroSlides()` - حفظ البيانات في قاعدة البيانات

### 2. View (Frontend Interface)
**الملف:** `resources/views/livewire/theme-customizer.blade.php`

**التحسينات:**
- واجهة حديثة ومرنة لإدارة الصور
- نظام بطاقات (Cards) لعرض الصور
- معاينة فورية للصور
- نموذج إضافة/تعديل ديناميكي
- رسائل تأكيد للعمليات الحساسة

### 3. Main Layout
**الملف:** `resources/views/themes/admin/theme/customize.blade.php`

**الإضافات:**
- مكتبة SortableJS للسحب والإفلات
- أنماط CSS للـ drag & drop
- JavaScript لتهيئة السحب والإفلات

---

## المكتبات المستخدمة

### Frontend
- **Tailwind CSS** - التصميم الحديث
- **Alpine.js** - التفاعلية البسيطة
- **Livewire** - التفاعلية الديناميكية بدون JavaScript معقد
- **SortableJS** - السحب والإفلات
- **Remix Icons** - الأيقونات

### Backend
- **Laravel Livewire** - بناء واجهات تفاعلية
- **Laravel Storage** - إدارة الملفات
- **Eloquent ORM** - قاعدة البيانات

---

## نصائح الاستخدام

### ✅ أفضل الممارسات:

1. **حجم الصور:**
   - استخدم صور بجودة عالية (لكن ليس أكثر من 2MB)
   - الأبعاد الموصى بها: 1920x1080 بكسل
   - استخدم تنسيق WebP للحصول على أفضل أداء

2. **النصوص:**
   - اجعل العناوين واضحة ومختصرة
   - استخدم دعوة للعمل قوية في نص الزر
   - تأكد من أن الروابط صحيحة

3. **الترتيب:**
   - ضع أهم صورة في البداية
   - رتب الصور حسب الأولوية

4. **الأداء:**
   - لا تضيف أكثر من اللازم (الحد الأقصى 6)
   - قلل حجم الصور قبل الرفع

### ⚠️ تحذيرات:

- **لا تحذف** صورة دون تأكد - الحذف نهائي
- **لا ترفع** صور أكبر من 2MB
- **تأكد** من صحة الروابط قبل الحفظ

---

## استرجاع البيانات في الثيم

### في ملفات Blade:

```php
@php
    $themeData = \App\Models\ThemeData::getActiveThemeData(
        auth()->user()->store_id ?? null,
        \App\Models\Setting::get('active_theme', 'default')
    );
    $heroSlides = $themeData->hero_data['slides'] ?? [];
@endphp

<!-- عرض الصور -->
@if(count($heroSlides) > 0)
    <div class="hero-slider">
        @foreach($heroSlides as $slide)
            <div class="hero-slide">
                <img src="{{ Storage::url($slide['image']) }}" alt="{{ $slide['title'] }}">
                <div class="hero-content">
                    <h1>{{ $slide['title'] }}</h1>
                    @if(isset($slide['subtitle']))
                        <p>{{ $slide['subtitle'] }}</p>
                    @endif
                    @if(isset($slide['button_text']) && isset($slide['button_link']))
                        <a href="{{ $slide['button_link'] }}" class="btn">
                            {{ $slide['button_text'] }}
                        </a>
                    @endif
                </div>
            </div>
        @endforeach
    </div>
@endif
```

### في Controllers:

```php
use App\Models\ThemeData;
use App\Models\Setting;

$storeId = auth()->user()->store_id ?? null;
$themeName = Setting::get('active_theme', 'default');
$themeData = ThemeData::getByStoreAndTheme($storeId, $themeName);

$heroSlides = $themeData->hero_data['slides'] ?? [];

// عدد الصور
$slidesCount = count($heroSlides);

// الصورة الأولى فقط
$firstSlide = $heroSlides[0] ?? null;

// صورة معينة
$specificSlide = $heroSlides[2] ?? null; // الصورة الثالثة
```

---

## الدعم والمشاكل

### مشاكل شائعة:

#### 1. لا يتم رفع الصورة
**الحل:**
- تأكد من حجم الصورة (أقل من 2MB)
- تأكد من تنسيق الصورة (PNG, JPG, WEBP)
- تأكد من صلاحيات المجلد `storage/app/public`

#### 2. لا يعمل السحب والإفلات
**الحل:**
- تأكد من تحميل مكتبة SortableJS
- افتح console المتصفح وتحقق من الأخطاء
- حدث الصفحة (F5)

#### 3. لا تظهر الصور في الموقع
**الحل:**
- تأكد من ربط storage:
  ```bash
  php artisan storage:link
  ```
- تأكد من وجود الصور في `storage/app/public/themes/`

---

## الترقيات المستقبلية

### مقترحات للتطوير:
- [ ] إضافة معاينة مباشرة للصور في الواجهة الأمامية
- [ ] دعم الفيديو في قسم البطل
- [ ] إضافة تأثيرات انتقال بين الصور
- [ ] دعم الصور المتجاوبة (Responsive)
- [ ] إضافة محرر نصوص غني (Rich Text Editor)
- [ ] جدولة ظهور الصور (Schedule)

---

## الخلاصة

تم بناء نظام حديث ومرن لتخصيص قسم البطل يدعم:
- ✅ حتى 6 صور مع بياناتها الكاملة
- ✅ السحب والإفلات لإعادة الترتيب
- ✅ معاينة فورية
- ✅ واجهة سهلة الاستخدام
- ✅ حفظ تلقائي
- ✅ تصميم حديث وجذاب

النظام جاهز للاستخدام ويعمل بكفاءة! 🚀

---

**تاريخ الإنشاء:** 13 أكتوبر 2025  
**الإصدار:** 1.0.0  
**المطور:** AI Assistant  

