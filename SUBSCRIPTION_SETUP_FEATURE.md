# صفحة إعداد المتجر بعد الاشتراك

## نظرة عامة
تم إضافة صفحة جديدة لإعداد المتجر بعد إتمام الدفع وتفعيل الخطة. تتيح هذه الصفحة للمستخدم:
- إدخال معرف المتجر (Store ID)
- اختيار الثيم المناسب
- إضافة الدومين المخصص (اختياري)

## الملفات المضافة/المعدلة

### 1. الملفات الجديدة
- `resources/views/subscriptions/setup.blade.php` - صفحة إعداد المتجر
- `resources/views/subscriptions/setup-success.blade.php` - صفحة النجاح للدومين المخصص

### 2. الملفات المعدلة
- `app/Http/Controllers/Admin/SettingController.php`:
  - تعديل `completeSubscriptionPayment()` للتوجيه إلى صفحة الإعداد
  - إضافة `subscriptionSetup()` - عرض صفحة الإعداد
  - إضافة `completeSetup()` - حفظ بيانات الإعداد مع توجيه ذكي
  - إضافة `setupSuccess()` - عرض صفحة النجاح للدومين المخصص

- `routes/web.php`:
  - إضافة مسار `GET /subscriptions/setup`
  - إضافة مسار `POST /subscriptions/setup/complete`
  - إضافة مسار `GET /subscriptions/setup/success`

## البيانات المحفوظة في جدول users

الحقول الثلاثة التالية موجودة بالفعل في جدول `users`:
- `store_id` - معرف المتجر الفريد
- `active_theme` - الثيم المختار (default, gamey, greenGame, zain)
- `custom_domain` - الدومين المخصص (اختياري)

## التحقق من صحة البيانات

### store_id
- مطلوب
- يجب أن يحتوي على أحرف إنجليزية وأرقام وشرطة فقط
- يتم التحقق من عدم التكرار

### active_theme
- مطلوب
- يجب أن يكون أحد القيم: default, gamey, greenGame, zain

### custom_domain
- اختياري
- يجب أن يكون بصيغة دومين صحيحة
- يتم التحقق من عدم التكرار إذا تم إدخاله

## سير العمل

1. المستخدم يختار خطة اشتراك
2. يتم التوجيه إلى صفحة الدفع
3. بعد إتمام الدفع، يتم تفعيل الاشتراك
4. **جديد**: يتم التوجيه إلى صفحة إعداد المتجر
5. المستخدم يملأ بيانات المتجر (store_id, theme, domain)
6. يتم حفظ البيانات في جدول users
7. **جديد**: يتم إنشاء HomePage للمتجر تلقائياً
8. **توجيه ذكي**:
   - **إذا أضاف دومين مخصص**: يتم توجيهه إلى صفحة نجاح تحتوي على رابط متجره مع إرشادات
   - **إذا لم يضف دومين**: يتم توجيهه مباشرة إلى لوحة التحكم (admin dashboard) لبدء إدارة المتجر

## الثيمات المتاحة

1. **default** - الافتراضي
   - تصميم عصري ونظيف مناسب لجميع أنواع المتاجر
   
2. **gamey** - جيمي
   - مثالي للألعاب وحسابات الألعاب مع تأثيرات نيون
   
3. **greenGame** - جرين جيم
   - تصميم رياضي مع لون أخضر جذاب
   
4. **zain** - زين
   - تصميم أنيق ومحترف للمتاجر الإلكترونية

## التوجيه الذكي بعد الإعداد

بعد إتمام إعداد المتجر، يتم التوجيه التلقائي بناءً على البيانات المدخلة:

### حالة 1: مع دومين مخصص
- **يتم**: التوجيه إلى صفحة نجاح خاصة (`setup-success.blade.php`)
- **تحتوي على**:
  - رسالة تهنئة مع رابط الدومين
  - إرشادات DNS
  - خطوات تالية واضحة
  - زر للوصول إلى لوحة التحكم
  - زر لزيارة المتجر
- **الهدف**: إعلام المستخدم بأن عليه انتظار نشر DNS (24-48 ساعة)

### حالة 2: بدون دومين مخصص
- **يتم**: التوجيه مباشرة إلى لوحة التحكم (`/admin`)
- **الهدف**: بدء إدارة المتجر فوراً (إضافة منتجات، تخصيص الإعدادات)

## ملاحظات

- يمكن للمستخدم تخطي صفحة الإعداد والعودة إليها لاحقاً
- يتم التحقق من وجود اشتراك نشط قبل الوصول لصفحة الإعداد
- التصميم متناسق مع صفحات الاشتراك الموجودة (نفس الأسلوب والألوان)
- جميع الرسائل باللغة العربية
- **جديد**: يتم إنشاء HomePage تلقائياً للمتجر عند الإعداد
- **جديد**: صفحة نجاح احترافية مع تأثيرات احتفالية (confetti) للمستخدمين ذوي الدومين المخصص

## الاختبار

### اختبار الحالة 1: مع دومين مخصص
1. قم بتسجيل الدخول
2. اختر خطة اشتراك
3. أكمل عملية الدفع
4. سيتم توجيهك تلقائياً إلى صفحة الإعداد
5. املأ البيانات:
   - store_id: `my-test-store`
   - active_theme: اختر أي ثيم
   - custom_domain: `mystore.com`
6. اضغط "إطلاق المتجر"
7. **النتيجة المتوقعة**: 
   - توجيه إلى صفحة النجاح مع رابط الدومين
   - رؤية تأثيرات احتفالية (confetti)
   - عرض إرشادات DNS

### اختبار الحالة 2: بدون دومين مخصص
1. قم بتسجيل الدخول
2. اختر خطة اشتراك
3. أكمل عملية الدفع
4. سيتم توجيهك تلقائياً إلى صفحة الإعداد
5. املأ البيانات:
   - store_id: `my-test-store-2`
   - active_theme: اختر أي ثيم
   - custom_domain: اتركه فارغاً
6. اضغط "إطلاق المتجر"
7. **النتيجة المتوقعة**: 
   - توجيه مباشر إلى `/admin` (لوحة التحكم)
   - رسالة نجاح في الأعلى

### التحقق من البيانات
بعد أي من الحالتين، تحقق من:
- جدول `users`: يجب أن يحتوي على `store_id`, `active_theme`, و `custom_domain`
- جدول `home_pages`: يجب إنشاء صفحة رئيسية للمتجر تلقائياً

